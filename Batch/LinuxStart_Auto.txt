Step 1: Install Xvfb (virtual display)

  sudo apt-get update
  sudo apt-get install xvfb -y

Step 2: Create the systemd service

  sudo nano /etc/systemd/system/mt5.service

Step 3: Paste this content:

[Unit]
Description=MetaTrader 5 Headless
After=network.target

[Service]
Type=simple
User=root
Environment="DISPLAY=:99"
Environment="WINEPREFIX=/root/.wine"
WorkingDirectory=/root/mt5

# Initial delay
ExecStartPre=/bin/sleep 10

# Start Xvfb and track its PID
ExecStartPre=/bin/bash -c '/usr/bin/Xvfb :99 -screen 0 1024x768x24 -ac +extension GLX +render -noreset & echo $! > /tmp/xvfb.pid && sleep 2'

# Start Python HTTP server and track its PID
ExecStartPre=/bin/bash -c 'cd /root/.wine/drive_c/users/root/Application\ Data/MetaQuotes/Terminal/Common/Files/ && python3 -m http.server 8567 & echo $! > /tmp/mt5-http.pid'

# Main MT5 process
ExecStart=/usr/bin/wine terminal64.exe /portable /config:C:\\users\\root\\Application Data\\MetaQuotes\\Terminal\\Common\\Files\\configur.ini

# Clean shutdown - kill tracked processes
ExecStopPost=/bin/bash -c 'if [ -f /tmp/mt5-http.pid ]; then kill $(cat /tmp/mt5-http.pid) 2>/dev/null; rm -f /tmp/mt5-http.pid; fi'
ExecStopPost=/bin/bash -c 'if [ -f /tmp/xvfb.pid ]; then kill $(cat /tmp/xvfb.pid) 2>/dev/null; rm -f /tmp/xvfb.pid; fi'
ExecStopPost=/usr/bin/pkill -9 -f winedevice
ExecStopPost=/usr/bin/pkill -9 wine

Restart=always
RestartSec=30
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target

Step 4: Open firewall port for web access

  sudo ufw allow 8567

Step 5: Enable and start the service

  sudo systemctl daemon-reload
  sudo systemctl enable mt5.service
  sudo systemctl start mt5.service

Step 6: Check if it's running
  sudo systemctl status mt5.service

Step 7: Access your files from browser

  http://173.249.29.68:8567
